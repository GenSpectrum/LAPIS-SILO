ARG DEPENDENCY_IMAGE=ghcr.io/genspectrum/lapis-silo-linter-dependencies:latest

FROM $DEPENDENCY_IMAGE AS linter
ARG THREADS=16

WORKDIR /src

COPY . ./

RUN conan install .. --build=missing --profile ../conanprofile --profile:build ../conanprofile --output-folder=build
RUN cmake -D BUILD_WITH_CLANG_TIDY=ON . -B build
RUN cmake --build build --parallel $THREADS

FROM debian:12

ARG TARGETPLATFORM

RUN apt update \
    && apt install -y \
    cmake=3.25.1-1 \
    python3-pip=23.0.1+dfsg-1 \
    software-properties-common=0.99.30-4.1~deb12u1 \
    wget=1.21.3-1+b2 \
    lsb-release-minimal=12.0-1

RUN pip install conan --break-system-packages

WORKDIR /src
COPY conanfile.py conanprofile.docker conanprofile.docker_arm ./
RUN if [ "$TARGETPLATFORM" = "linux/arm64" ]; then \
        mv conanprofile.docker_arm conanprofile; \
    else \
        mv conanprofile.docker conanprofile; \
    fi

RUN conan install . --build=missing --profile ./conanprofile --profile:build ./conanprofile --output-folder=build

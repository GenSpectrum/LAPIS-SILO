FROM debian:oldstable

ARG TARGETPLATFORM

RUN apt-get update && apt-get dist-upgrade -y \
    && apt-get install -y \
    build-essential cmake ninja-build python3 python3-pip python3-venv pipx software-properties-common wget gnupg lsb-release jq curl patchelf clang-tidy-19 clang-format-19 nodejs npm

# ensurepath adds a line to .profile
# which puts the pipx install directory ~/.local/bin into the PATH variable
RUN python3 -m pipx ensurepath
# .profile is only sourced on relogin. Dockerfile shells do not login by default.
# This line tells it to execute all subsequent commands with a prior login
SHELL ["/bin/bash", "--login", "-c"]

RUN python3 -m pipx install uv==0.10.2

WORKDIR /src
COPY conanfile.py ./
COPY buildScripts/ ./buildScripts/

RUN bash buildScripts/create-conanprofile
RUN bash buildScripts/install-dependencies
